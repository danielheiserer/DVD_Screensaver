<!DOCTYPE html>
<html>
<head>
	<style>
		body {
			margin: 0;
			overflow: hidden;
			height: 100vh;
			width: 100vw;
		}

		.block {
			background: yellowgreen;
			height: 50px;
			width: 50px;
			/*animation: spinner 1500ms infinite linear;*/
			position: absolute;
			top: calc(50% - 25px);
			left: calc(50% - 25px);
			transition: all linear 3s;
			z-index: 1;
			border: solid green 20px;
			box-sizing: border-box;
			opacity: .7;
			border-radius: 50%;
			will-change: left, top;
		}

		.angle,
		.angle_shadow {
			background: black;
			height: 2000px;
			width: 2px;
			position: absolute;
			left: calc(50% + 1px);
			bottom: calc(50% - 2000px);
			transform: rotate(360deg);
			border-bottom: white solid 2000px;
		}

		.angle_shadow {
			background: #dedede;
			z-index: -1;
		}

		.display {
			position: absolute;
			bottom: 60px;
			left: 25px;
			height: 20px;
			width: 50px;
			background: powderblue;
			opacity: .8;
			padding: 10px;

		}

		.display input{
			max-width: 90%;
		}

		.reset_button {
			position: absolute;
			bottom: 15px;
			left: 25px;
			height: 20px;
			width: 50px;
			background: powderblue;
			opacity: .8;
			padding: 10px;
			cursor: pointer;
		}

		.debug_ankathete_element {
			background: aqua;
			height: 2000px;
			width: 2px;
			position: absolute;
			left: calc(50% + 1px);
			bottom: calc(50% - 2000px);
			border-bottom: white solid 2000px;
		}

		.debug_gegenkathete_element {
			background: green;
			height: 2000px;
			width: 2px;
			position: absolute;
			left: calc(50% + 1px);
			bottom: calc(50% - 2000px);
			border-bottom: white solid 2000px;
		}

		@keyframes spinner {
			0% {
				transform: rotate(0deg);

			}

			100% {
				transform: rotate(360deg);
			}
		}

	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
</head>
<body>
<div class="block"></div>
</body>
<script>
	// TO-DO
	// Bounce() sollte mehr Funktionen nutzen? (Auslagerung)

	var debug = true;
	var debug_bounce_counter = 0;
	var debug_bounce_limit = 0;
	$(document).ready(function () {

		$('.block').bind("mouseover",function(){
alert('erwischt');
			console.log('erwischt');
		});



		var block_speed = false; //in px per second

		if (debug) {
			let angle = document.createElement('DIV');
			$(angle).addClass('angle');
			$('body').append(angle);

			let angle_shadow = document.createElement('DIV');
			$(angle_shadow).addClass('angle_shadow');
			$('body').append(angle_shadow);



			let display = document.createElement('DIV');
			$(display).addClass('display');
			let displayinput = document.createElement('INPUT');
			$(displayinput).attr('type', 'number');
			$(displayinput).val(62);
			$(display).append(displayinput);
			$('body').append(display);

			let reset_button = document.createElement('DIV');
			$(reset_button).addClass('reset_button');
			$(reset_button).html('Reset');
			$('body').append(reset_button);

			$('.reset_button').bind('click', reset);

			$('.display input').change(function() {
				let val = $('.display input').first().val();
				val = Math.abs(val % 360);
				$('.display input').first().val(val);
				$('.angle_shadow').css('transform', 'rotate(' + val + 'deg');
			});

		}
		// init
		bounce(get_random_degree());

		function get_random_degree(){
			return parseInt(Math.random() * 100000 % 360);
		}

		function reset() {
			$('.block').remove();
			$('.debug_ankathete_element').remove();
			$('.debug_gegenkathete_element').remove();
			let block = document.createElement('DIV');
			$(block).addClass('block');
			$('body').append(block);

			debug_bounce_counter = 0;

			let	degree = $('.display input')[0].value;

			bounce(degree);
		}

	});


	function bounce(einfallswinkel, seite = 'init'){

		let ausfallswinkel = false;
		//einfallswinkel = ausfallswinkel
		if(seite == 'oben' || seite == 'unten') {
			ausfallswinkel = 180 - einfallswinkel;
			if (ausfallswinkel < 0) {
				ausfallswinkel = 360 + ausfallswinkel;
			}
		} else if(seite == 'init'){
			ausfallswinkel = einfallswinkel;

		}else {
			ausfallswinkel = Math.abs(360 - einfallswinkel);
		}

		let block_width = parseInt($('.block').css('width'));
		let block_height = parseInt($('.block').css('height'));

		let block_top = parseInt($('.block').css('top'));
		let block_bottom = parseInt($('.block').css('top')) + block_height;
		let block_left = parseInt($('.block').css('left'));
		let block_right = parseInt($('.block').css('left')) + block_width;

		let hypotenuse = false;
		let block_speed = 250; //in px pro Sekunde
		let time_next_bounce = 2;

		let debug_ankathete = false;
		let debug_gegenkathete = false;
		let debug_direction = false;

		let space_top = false;
		let space_bottom = false;
		let space_left = false;
		let space_right = false;

		let ankathete_oben = false;
		let gegenkathete_oben = false;
		let ankathete_unten = false;
		let gegenkathete_unten = false;
		let ankathete_links = false;
		let gegenkathete_links = false;
		let ankathete_rechts = false;
		let gegenkathete_rechts = false;

		let distanz = false;
		let framecollision = false;

		let rotate_value = false;

		let correct = false;
		let correct_top = false;
		let correct_side = false;

		let correct_top_kathete = false;
		let correct_side_kathete = false;

		let hypotenuse_top = false;
		let hypotenuse_side = false;

		let corrected_top = false;
		let corrected_side = false;

		switch (true) {
			case (ausfallswinkel < 90):
				space_top = block_top;
				space_right = Math.abs(block_right - $('body').width());

				//check oben
				ankathete_oben = space_top + block_height / 2;
				gegenkathete_oben = parseInt(Math.abs(Math.tan((ausfallswinkel * Math.PI) / 180) * ankathete_oben));

				//checken rechts
				ankathete_rechts = space_right + block_width / 2;
				gegenkathete_rechts = parseInt(Math.abs(Math.tan(((90 - ausfallswinkel) * Math.PI) / 180) * ankathete_rechts));


				//Positionskorrektur
				correct = 0;

				// a^2 + b^2 = c^2 -> im ersten Schritt ist correct_x a oder b und im zweiten c

				correct_top_kathete = parseInt(Math.abs(Math.tan((ausfallswinkel * Math.PI) / 180) * (block_height / 2)));
				correct_top = parseInt(Math.sqrt(Math.pow(correct_top_kathete, 2) + Math.pow(block_height / 2, 2)));

				correct_side_kathete = parseInt(Math.abs(Math.tan(((90 - ausfallswinkel) * Math.PI) / 180) * block_width / 2));
				correct_side = parseInt(Math.sqrt(Math.pow(correct_side_kathete, 2) + Math.pow(block_width / 2, 2)));

				hypotenuse_top = parseInt(Math.sqrt(Math.pow(ankathete_oben, 2) + Math.pow(gegenkathete_oben, 2)));
				hypotenuse_side = parseInt(Math.sqrt(Math.pow(ankathete_rechts, 2) + Math.pow(gegenkathete_rechts, 2)));

				//kürzere Rute

				corrected_top = Math.abs((hypotenuse_top - correct_top));
				corrected_side = Math.abs((hypotenuse_side - correct_side));

				if(corrected_top < corrected_side){
					distanz = gegenkathete_oben;
					framecollision = 'oben';
				}else {
					distanz = gegenkathete_rechts;
					framecollision = 'rechts';
				}

				if (framecollision == 'oben'){
					hypotenuse = hypotenuse_top - correct_top;
					correct = correct_top_kathete;
				}else {
					hypotenuse = hypotenuse_side - correct_side;
					correct = correct_side_kathete;
				}

				debug_direction = framecollision;
				if (debug_direction == 'oben') {
					debug_direction = 'quad_1_oben';
					debug_ankathete = ankathete_oben;
					debug_gegenkathete = gegenkathete_oben;
				}else {
					debug_direction = 'quad_1_rechts';
					debug_ankathete = ankathete_rechts;
					debug_gegenkathete = gegenkathete_rechts;
				}

				//geschw noch ausrechnen time_next_bounce

				time_next_bounce = hypotenuse / block_speed;
				console.log('Time for Trans: ' + time_next_bounce);

				$('.block').css({
					transition: "all linear " + time_next_bounce + "s"
				});

				rotate_value = 'rotate(' + ausfallswinkel + 'deg)';
				$('.angle').css({
					transform: rotate_value
				});

				if (framecollision == 'oben') {
					$('.block').css({
						top: "0",
						left: block_left + distanz - correct
					});
				}else{
					$('.block').css({
						top: block_top - distanz + correct,
						left: $('body').width() - block_width
					});
				}

				break;
			case (ausfallswinkel < 180):

				space_bottom = $('body').height() - block_bottom;
				space_right = Math.abs(block_right - $('body').width());

				//check unten
				ankathete_unten = space_bottom + block_height / 2;
				gegenkathete_unten = parseInt(Math.abs(Math.tan(((180 - ausfallswinkel) * Math.PI) / 180) * ankathete_unten));

				//checken rechts
				ankathete_rechts = space_right + block_width / 2;
				gegenkathete_rechts = parseInt(Math.abs(Math.tan(((ausfallswinkel - 90) * Math.PI) / 180) * ankathete_rechts));


				//Positionskorrektur
				correct = 0;

				// a^2 + b^2 = c^2 -> im ersten Schritt ist correct_x a oder b und im zweiten c

				correct_top_kathete = parseInt(Math.abs(Math.tan(((180 - ausfallswinkel) * Math.PI) / 180) * (block_height / 2)));
				correct_top = parseInt(Math.abs(Math.sqrt(Math.pow(correct_top_kathete, 2) + Math.pow(block_height / 2, 2))));

				correct_side_kathete = parseInt(Math.abs(Math.tan(((ausfallswinkel - 90) * Math.PI) / 180) * block_width / 2));
				correct_side = parseInt(Math.abs(Math.sqrt(Math.pow(correct_side_kathete, 2) + Math.pow(block_width / 2, 2))));

				hypotenuse_top = parseInt(Math.sqrt(Math.pow(ankathete_unten, 2) + Math.pow(gegenkathete_unten, 2)));
				hypotenuse_side = parseInt(Math.sqrt(Math.pow(ankathete_rechts, 2) + Math.pow(gegenkathete_rechts, 2)));

				//kürzere Rute

				corrected_top = Math.abs((hypotenuse_top - correct_top));
				corrected_side = Math.abs((hypotenuse_side - correct_side));

				if(corrected_top < corrected_side){
					distanz = gegenkathete_unten;
					framecollision = 'unten';
				}else {
					distanz = gegenkathete_rechts;
					framecollision = 'rechts';
				}

				if (framecollision == 'unten'){
					hypotenuse = hypotenuse_top - correct_top;
					correct = correct_top_kathete;
				}else {
					hypotenuse = hypotenuse_side - correct_side;
					correct = correct_side_kathete;
				}

				debug_direction = framecollision;
				if(debug_direction == 'unten') {
					debug_direction = 'quad_2_unten';
					debug_ankathete = ankathete_unten;
					debug_gegenkathete = gegenkathete_unten;
				}else{
					debug_direction = 'quad_2_rechts';
					debug_ankathete = ankathete_rechts;
					debug_gegenkathete = gegenkathete_rechts;
				}

				//geschw noch ausrechnen time_next_bounce

				time_next_bounce = Math.abs(hypotenuse) / block_speed;
				console.log('Time for Trans: ' + time_next_bounce);

				$('.block').css({
					transition: "all linear " + time_next_bounce + "s"
				});

				rotate_value = 'rotate(' + ausfallswinkel + 'deg)';
				$('.angle').css({
					transform: rotate_value
				});

				if (framecollision == 'unten') {
					$('.block').css({
						top: $('body').height() - block_height,
						left: block_left + distanz - correct
					});
				}else{
					$('.block').css({
						top: block_top + distanz - correct,
						left: $('body').width() - block_width
					});
				}

				break;
			case (ausfallswinkel < 270):

				space_bottom = $('body').height() - block_bottom;
				space_left = block_left;

				//check unten
				ankathete_unten = space_bottom + block_height / 2;
				gegenkathete_unten = parseInt(Math.abs(Math.tan(((ausfallswinkel - 180) * Math.PI) / 180) * ankathete_unten));

				//checken rechts
				ankathete_links = space_left + block_width / 2;
				gegenkathete_links = parseInt(Math.abs(Math.tan(((270 - ausfallswinkel) * Math.PI) / 180) * ankathete_links));

				//Positionskorrektur
				correct = 0;

				// a^2 + b^2 = c^2 -> im ersten Schritt ist correct_x a oder b und im zweiten c

				correct_top_kathete = parseInt(Math.abs(Math.tan(((ausfallswinkel - 180) * Math.PI) / 180) * (block_height / 2)));
				correct_top = parseInt(Math.abs(Math.sqrt(Math.pow(correct_top_kathete, 2) + Math.pow(block_height / 2, 2))));

				correct_side_kathete = parseInt(Math.abs(Math.tan(((270 - ausfallswinkel) * Math.PI) / 180) * block_width / 2));
				correct_side = parseInt(Math.abs(Math.sqrt(Math.pow(correct_side_kathete, 2) + Math.pow(block_width / 2, 2))));

				hypotenuse_top = parseInt(Math.sqrt(Math.pow(ankathete_unten, 2) + Math.pow(gegenkathete_unten, 2)));
				hypotenuse_side = parseInt(Math.sqrt(Math.pow(ankathete_links, 2) + Math.pow(gegenkathete_links, 2)));

				//kürzere Rute

				corrected_top = Math.abs((hypotenuse_top - correct_top));
				corrected_side = Math.abs((hypotenuse_side - correct_side));

				if(corrected_top < corrected_side){
					distanz = gegenkathete_unten;
					framecollision = 'unten';
				}else {
					distanz = gegenkathete_rechts;
					framecollision = 'rechts';
				}

				if (framecollision == 'unten'){
					hypotenuse = hypotenuse_top - correct_top;
					correct = correct_top_kathete;
				}else {
					hypotenuse = hypotenuse_side - correct_side;
					correct = correct_side_kathete;
				}

				debug_direction = framecollision;
				if(debug_direction == 'unten') {
					debug_direction = 'quad_3_unten';
					debug_ankathete = ankathete_unten;
					debug_gegenkathete = gegenkathete_unten;
				}else{
					debug_direction = 'quad_3_links';
					debug_ankathete = ankathete_links;
					debug_gegenkathete = gegenkathete_links;
				}

				//geschw noch ausrechnen
				if (framecollision == 'unten') {
					hypotenuse = parseInt(Math.sqrt(Math.pow(ankathete_unten, 2) + Math.pow(gegenkathete_unten, 2)));
				}else{
					hypotenuse = parseInt(Math.sqrt(Math.pow(ankathete_links, 2) + Math.pow(gegenkathete_links, 2)));
				}
				time_next_bounce = hypotenuse / block_speed;
				console.log('Time for Trans: ' + time_next_bounce);
				$('.block').css({
					transition: "all linear " + time_next_bounce + "s"
				});

				rotate_value = 'rotate(' + ausfallswinkel + 'deg)';
				$('.angle').css({
					transform: rotate_value
				});

				if (framecollision == 'unten') {
					$('.block').css({
						top: $('body').height() - block_height,
						left: block_left - distanz + correct
					});
				}else{
					$('.block').css({
						top: block_top + distanz - correct,
						left: '0'
					});
				}

				break;
			case (ausfallswinkel < 360):

				space_top = block_top;
				space_left = block_left;

				//check oben
				ankathete_oben = space_top + block_height / 2;
				gegenkathete_oben = parseInt(Math.abs(Math.tan(((360 - ausfallswinkel) * Math.PI) / 180) * ankathete_oben));

				//checken links
				ankathete_links = space_left + block_width / 2;
				gegenkathete_links = parseInt(Math.abs(Math.tan(((ausfallswinkel - 270) * Math.PI) / 180) * ankathete_links));

				//kürzere Rute (stimmt in ecken nicht immer ganz, weil wir die korrektur berücksichtigen müssten)
				distanz = gegenkathete_oben < ankathete_links ? gegenkathete_oben : gegenkathete_links;
				framecollision = gegenkathete_oben < ankathete_links ? 'oben' : 'links';

				debug_direction = framecollision;
				if(debug_direction == 'oben') {
					debug_direction = 'quad_4_oben';
					debug_ankathete = ankathete_oben;
					debug_gegenkathete = gegenkathete_oben;
				}else{
					debug_direction = 'quad_4_links';
					debug_ankathete = ankathete_links;
					debug_gegenkathete = gegenkathete_links;
				}


				//Positionskorrektur
				correct = 0;

				if(framecollision ==  'oben') {
					correct = parseInt(Math.abs(Math.tan(((360 - ausfallswinkel) * Math.PI) / 180) * (block_height / 2)));
				}else{
					correct = parseInt(Math.abs(Math.tan(((ausfallswinkel - 270) * Math.PI) / 180) * block_width / 2));
				}

				//geschw noch ausrechnen
				if (framecollision == 'oben') {
					hypotenuse = parseInt(Math.sqrt(Math.pow(ankathete_oben, 2) + Math.pow(gegenkathete_oben, 2)));
				}else{
					hypotenuse = parseInt(Math.sqrt(Math.pow(ankathete_links, 2) + Math.pow(gegenkathete_links, 2)));
				}
				time_next_bounce = hypotenuse / block_speed;
				console.log('Time for Trans: ' + time_next_bounce);
				$('.block').css({
					transition: "all linear " + time_next_bounce + "s"
				});

				rotate_value = 'rotate(' + ausfallswinkel + 'deg)';
				$('.angle').css({
					transform: rotate_value
				});

				if (framecollision == 'oben') {
					$('.block').css({
						top:'0',
						left: block_left - distanz + correct
					});
				}else{
					$('.block').css({
						top: block_top - distanz + correct,
						left: '0'
					});
				}

				break;
			default : break;
		}

		if (debug) {
			let debug_ankathete_element = document.createElement('DIV');
			$(debug_ankathete_element).addClass('debug_ankathete_element');
			$('body').append(debug_ankathete_element);

			let debug_gegenkathete_element = document.createElement('DIV');
			$(debug_gegenkathete_element).addClass('debug_gegenkathete_element');
			$('body').append(debug_gegenkathete_element);

			let new_pos_bottom = parseInt($('.block').css('bottom')) + block_height / 2;
			let new_pos_left = parseInt($('.block').css('left')) + block_width / 2;

			$('.angle').css('bottom', 'calc(' + new_pos_bottom + 'px - 2000px)');

			$('.angle').css('left', 'calc(' + new_pos_left + 'px + 1px)');


			$('.debug_ankathete_element').css({
				left: new_pos_left + 'px',
				bottom: 'calc(' + new_pos_bottom + 'px - ' + debug_ankathete + 'px)',
			});

			$('.debug_gegenkathete_element').css({
				left: new_pos_left + 'px',
				bottom: 'calc(' + new_pos_bottom + 'px - ' + debug_gegenkathete + 'px)',
			});

			if (debug_direction == 'quad_1_oben') {
				$('.debug_ankathete_element').css({
					height: debug_ankathete + 'px',
					'border-bottom': 'white solid ' + debug_ankathete + 'px',
					transform: 'rotate(0deg) translate(' + debug_gegenkathete + 'px)'
				});
				$('.debug_gegenkathete_element').css({
					height: debug_gegenkathete + 'px',
					'border-bottom': 'white solid ' + debug_gegenkathete + 'px',
					transform: 'rotate(90deg)'
				});
			}else if(debug_direction == 'quad_1_rechts'){
				$('.debug_gegenkathete_element').css({
					height: debug_gegenkathete + 'px',
					'border-bottom': 'white solid ' + debug_gegenkathete + 'px',
					transform: 'rotate(0deg)'
				});
				$('.debug_ankathete_element').css({
					height: debug_ankathete + 'px',
					'border-bottom': 'white solid ' + debug_ankathete + 'px',
					transform: 'rotate(90deg) translate(-' + debug_gegenkathete + 'px)'
				});
			} else if(debug_direction == 'quad_2_rechts'){
				$('.debug_gegenkathete_element').css({
					height: debug_gegenkathete + 'px',
					'border-bottom': 'white solid ' + debug_gegenkathete + 'px',
					transform: 'rotate(180deg)'
				});
				$('.debug_ankathete_element').css({
					height: debug_ankathete + 'px',
					'border-bottom': 'white solid ' + debug_ankathete + 'px',
					transform: 'rotate(90deg) translate(' + debug_gegenkathete + 'px)'
				});
			} else if(debug_direction == 'quad_2_unten'){
				$('.debug_ankathete_element').css({
					height: debug_ankathete + 'px',
					'border-bottom': 'white solid ' + debug_ankathete + 'px',
					transform: 'rotate(0deg) translate(' + debug_gegenkathete + 'px, ' + debug_ankathete + 'px)'
				});
				$('.debug_gegenkathete_element').css({
					height: debug_gegenkathete + 'px',
					'border-bottom': 'white solid ' + debug_gegenkathete + 'px',
					transform: 'rotate(90deg)'
				});
			} else if(debug_direction == 'quad_3_unten'){
				$('.debug_ankathete_element').css({
					height: debug_ankathete + 'px',
					'border-bottom': 'white solid ' + debug_ankathete + 'px',
					transform: 'rotate(0deg) translate(-' + debug_gegenkathete + 'px, ' + debug_ankathete + 'px)'
				});
				$('.debug_gegenkathete_element').css({
					height: debug_gegenkathete + 'px',
					'border-bottom': 'white solid ' + debug_gegenkathete + 'px',
					transform: 'rotate(270deg)'
				});
			} else if(debug_direction == 'quad_3_links'){
				$('.debug_gegenkathete_element').css({
					height: debug_gegenkathete + 'px',
					'border-bottom': 'white solid ' + debug_gegenkathete + 'px',
					transform: 'rotate(180deg)'
				});
				$('.debug_ankathete_element').css({
					height: debug_ankathete + 'px',
					'border-bottom': 'white solid ' + debug_ankathete + 'px',
					transform: 'rotate(90deg) translate(' + debug_gegenkathete + 'px, ' + debug_ankathete + 'px)'
				});
			} else if(debug_direction == 'quad_4_links'){
				$('.debug_gegenkathete_element').css({
					height: debug_gegenkathete + 'px',
					'border-bottom': 'white solid ' + debug_gegenkathete + 'px',
					transform: 'rotate(0deg)'
				});
				$('.debug_ankathete_element').css({
					height: debug_ankathete + 'px',
					'border-bottom': 'white solid ' + debug_ankathete + 'px',
					transform: 'rotate(90deg) translate(-' + debug_gegenkathete + 'px, ' + debug_ankathete + 'px)'
				});
			} else if(debug_direction == 'quad_4_oben'){
				$('.debug_ankathete_element').css({
					height: debug_ankathete + 'px',
					'border-bottom': 'white solid ' + debug_ankathete + 'px',
					transform: 'rotate(0deg) translate(-' + debug_gegenkathete + 'px)'
				});
				$('.debug_gegenkathete_element').css({
					height: debug_gegenkathete + 'px',
					'border-bottom': 'white solid ' + debug_gegenkathete + 'px',
					transform: 'rotate(270deg)'
				});
			}

		}

		setTimeout(function () {
			if (debug) {
				if (debug_bounce_counter < debug_bounce_limit) {
					debug_bounce_counter++;
					bounce(ausfallswinkel, framecollision);
				}
			}else {
				bounce(ausfallswinkel, framecollision);
			}
		}, time_next_bounce * 1000);

	}
</script>
</html>
